//Warning: Legacy file. May be changed later.

#include <stdio.h>
#include "MathLibrary.h"

//Source: https://en.wikipedia.org/wiki/Gaussian_quadrature
//				<- https://en.wikipedia.org/wiki/Legendre_polynomials#Rodrigues'_formula_and_other_explicit_formulas

//Macro definitions
#define __ML_CI_EAT_BRACE(...) __VA_ARGS__
#define __ML_CI_LIST_BUILD_ONE(n, PointList, WeightList)	\
	const static double fPointList ## n [n] = __ML_CI_EAT_BRACE ## PointList; const static double fWeightList ## n [n] = __ML_CI_EAT_BRACE ## WeightList
#define __ML_CI_LIST_MAP(func)				\
	func(1, fPointList1, fWeightList1)		\
	func(2, fPointList2, fWeightList2)		\
	func(3, fPointList3, fWeightList3)		\
	func(4, fPointList4, fWeightList4)		\
	func(5, fPointList5, fWeightList5)		\
	func(6, fPointList6, fWeightList6)		\
	func(7, fPointList7, fWeightList7)		\
	func(8, fPointList8, fWeightList8)		\
	func(9, fPointList9, fWeightList9)		\
	func(10, fPointList10, fWeightList10)	\
	func(11, fPointList11, fWeightList11)	\
	func(12, fPointList12, fWeightList12)	\
	func(13, fPointList13, fWeightList13)	\
	func(14, fPointList14, fWeightList14)	\
	func(15, fPointList15, fWeightList15)	\
	func(16, fPointList16, fWeightList16)	\
	func(17, fPointList17, fWeightList17)	\
	func(18, fPointList18, fWeightList18)	\
	func(19, fPointList19, fWeightList19)	\
	func(20, fPointList20, fWeightList20)
#define __ML_CI_LIST_BUILD_CASE(n, fPointList, fWeightList) case (n): pfPoint = (fPointList); pfWeight = (fWeightList); break;

//Constant definitions
__ML_CI_LIST_BUILD_ONE(
	1,
	({ 0 }),
	({ 2 })
);
__ML_CI_LIST_BUILD_ONE(
	2,
	({ -0.577350269189625764509, 0.577350269189625764509 }),
	({ 1, 1 })
);
__ML_CI_LIST_BUILD_ONE(
	3,
	({ -0.774596669241483377036, 0, 0.774596669241483377036 }),
	({ 0.555555555555555555556, 0.888888888888888888889, 0.555555555555555555556 })
);
__ML_CI_LIST_BUILD_ONE(
	4,
	({ -0.861136311594052575224, -0.339981043584856264803, 0.339981043584856264803, 0.861136311594052575224 }),
	({ 0.347854845137453857373, 0.652145154862546142627, 0.652145154862546142627, 0.347854845137453857373 })
);
__ML_CI_LIST_BUILD_ONE(
	5,
	({ -0.906179845938663992798, -0.538469310105683091036, 0, 0.538469310105683091036, 0.906179845938663992798 }),
	({ 0.236926885056189087514, 0.478628670499366468041, 0.568888888888888888889, 0.478628670499366468041, 0.236926885056189087514 })
);
__ML_CI_LIST_BUILD_ONE(
	6,
	({ -0.932469514203152027812, -0.661209386466264513661, -0.238619186083196908631, 0.238619186083196908631, 0.661209386466264513661,	\
		0.932469514203152027812 }),
	({ 0.171324492379170345040, 0.360761573048138607570, 0.467913934572691047390, 0.467913934572691047390, 0.360761573048138607570,	\
		0.171324492379170345040 })
);
__ML_CI_LIST_BUILD_ONE(
	7,
	({ -0.949107912342758524526, -0.741531185599394439864, -0.405845151377397166907, 0, 0.405845151377397166907, 0.741531185599394439864,	\
		0.949107912342758524526 }),
	({ 0.129484966168869693271, 0.279705391489276667901, 0.381830050505118944950, 0.417959183673469387755, 0.381830050505118944950,	\
		0.279705391489276667901, 0.129484966168869693271 })
);
__ML_CI_LIST_BUILD_ONE(
	8,
	({ -0.960289856497536231684, -0.796666477413626739592, -0.525532409916328985818, -0.183434642495649804939, 0.183434642495649804939,	\
		0.525532409916328985818, 0.796666477413626739592, 0.960289856497536231684 }),
	({ 0.101228536290376259153, 0.222381034453374470544, 0.313706645877887287338, 0.362683783378361982965, 0.362683783378361982965,	\
		0.313706645877887287338, 0.222381034453374470544, 0.101228536290376259153 })
);
__ML_CI_LIST_BUILD_ONE(
	9,
	({ -0.968160239507626089836, -0.836031107326635794299, -0.613371432700590397309, -0.324253423403808929039, 0, 0.324253423403808929039,	\
		0.613371432700590397309, 0.836031107326635794299, 0.968160239507626089836 }),
	({ 0.0812743883615744119719, 0.180648160694857404058, 0.260610696402935462319, 0.312347077040002840069, 0.330239355001259763165,	\
		0.312347077040002840069, 0.260610696402935462319, 0.180648160694857404058, 0.0812743883615744119719 })
);
__ML_CI_LIST_BUILD_ONE(
	10,
	({ -0.973906528517171720078, -0.865063366688984510732, -0.679409568299024406234, -0.433395394129247190799, -0.148874338981631210885,	\
		0.148874338981631210885, 0.433395394129247190799, 0.679409568299024406234, 0.865063366688984510732, 0.973906528517171720078 }),
	({ 0.0666713443086881375936, 0.149451349150580593146, 0.219086362515982043996, 0.269266719309996355091, 0.295524224714752870174,	\
		0.295524224714752870174, 0.269266719309996355091, 0.219086362515982043996, 0.149451349150580593146, 0.0666713443086881375936 })
);
__ML_CI_LIST_BUILD_ONE(
	11,
	({ -0.978228658146056992804, -0.887062599768095299075, -0.730152005574049324093, -0.519096129206811815926, -0.269543155952344972332,	\
		0, 0.269543155952344972332, 0.519096129206811815926, 0.730152005574049324093, 0.887062599768095299075, 0.978228658146056992804 }),
	({ 0.0556685671161736664828, 0.125580369464904624635, 0.186290210927734251426, 0.233193764591990479919, 0.262804544510246662181,	\
		0.272925086777900630714, 0.262804544510246662181, 0.233193764591990479919, 0.186290210927734251426, 0.125580369464904624635,	\
		0.0556685671161736664828 })
);
__ML_CI_LIST_BUILD_ONE(
	12,
	({ -0.981560634246719250691, -0.904117256370474856678, -0.769902674194304687037, -0.587317954286617447297, -0.367831498998180193753,	\
		-0.125233408511468915472, 0.125233408511468915472, 0.367831498998180193753, 0.587317954286617447297, 0.769902674194304687037,	\
		0.904117256370474856678, 0.981560634246719250691 }),
	({ 0.0471753363865118271946, 0.106939325995318430960, 0.160078328543346226335, 0.203167426723065921749, 0.233492536538354808761,	\
		0.249147045813402785001, 0.249147045813402785001, 0.233492536538354808761, 0.203167426723065921749, 0.160078328543346226335,	\
		0.106939325995318430960, 0.0471753363865118271946 })
);
__ML_CI_LIST_BUILD_ONE(
	13,
	({ -0.984183054718588149473, -0.917598399222977965207, -0.801578090733309912794, -0.642349339440340220644, -0.448492751036446852878,	\
		-0.230458315955134794066, 0, 0.230458315955134794066, 0.448492751036446852878, 0.642349339440340220644, 0.801578090733309912794,	\
		0.917598399222977965207, 0.984183054718588149473 }),
	({ 0.0404840047653158795200, 0.0921214998377284479144, 0.138873510219787238464, 0.178145980761945738280, 0.207816047536888502313,	\
		0.226283180262897238412, 0.232551553230873910195, 0.226283180262897238412, 0.207816047536888502313, 0.178145980761945738280,	\
		0.138873510219787238464, 0.0921214998377284479144, 0.0404840047653158795200 })
);
__ML_CI_LIST_BUILD_ONE(
	14,
	({ -0.986283808696812338842, -0.928434883663573517336, -0.827201315069764993190, -0.687292904811685470148, -0.515248636358154091965,	\
		-0.319112368927889760436, -0.108054948707343662066, 0.108054948707343662066, 0.319112368927889760436, 0.515248636358154091965,	\
		0.687292904811685470148, 0.827201315069764993190, 0.928434883663573517336, 0.986283808696812338842 }),
	({ 0.0351194603317518630318, 0.0801580871597602098056, 0.121518570687903184689, 0.157203167158193534570, 0.185538397477937813742,	\
		0.205198463721295603966, 0.215263853463157790196, 0.215263853463157790196, 0.205198463721295603966, 0.185538397477937813742,	\
		0.157203167158193534570, 0.121518570687903184689, 0.0801580871597602098056, 0.0351194603317518630318 })
);
__ML_CI_LIST_BUILD_ONE(
	15,
	({ -0.987992518020485428490, -0.937273392400705904308, -0.848206583410427216201, -0.724417731360170047416, -0.570972172608538847537,	\
		-0.394151347077563369897, -0.201194093997434522301, 0, 0.201194093997434522301, 0.394151347077563369897, 0.570972172608538847537,	\
		0.724417731360170047416, 0.848206583410427216201, 0.937273392400705904308, 0.987992518020485428490 }),
	({ 0.0307532419961172683546, 0.0703660474881081247093, 0.107159220467171935012, 0.139570677926154314448, 0.166269205816993933553,	\
		0.186161000015562211027, 0.198431485327111576456, 0.202578241925561272881, 0.198431485327111576456, 0.186161000015562211027,	\
		0.166269205816993933553, 0.139570677926154314448, 0.107159220467171935012, 0.0703660474881081247093, 0.0307532419961172683546 })
);
__ML_CI_LIST_BUILD_ONE(
	16, 
	({ -0.989400934991649932596, -0.944575023073232576078, -0.865631202387831743880, -0.755404408355003033895, -0.617876244402643748447,	\
		-0.458016777657227386342, -0.281603550779258913230, -0.0950125098376374401853, 0.0950125098376374401853, 0.281603550779258913230,	\
		0.458016777657227386342, 0.617876244402643748447, 0.755404408355003033895, 0.865631202387831743880, 0.944575023073232576078,	\
		0.989400934991649932596 }), 
	({ 0.0271524594117540948518, 0.0622535239386478928628, 0.0951585116824927848099, 0.124628971255533872052, 0.149595988816576732082,	\
		0.169156519395002538189, 0.182603415044923588867, 0.189450610455068496285, 0.189450610455068496285, 0.182603415044923588867,	\
		0.169156519395002538189, 0.149595988816576732082, 0.124628971255533872052, 0.0951585116824927848099, 0.0622535239386478928628,	\
		0.0271524594117540948518 })
);
__ML_CI_LIST_BUILD_ONE(
	17, 
	({ -0.990575475314417335675, -0.950675521768767761223, -0.880239153726985902123, -0.781514003896801406925, -0.657671159216690765850,	\
		-0.512690537086476967886, -0.351231763453876315297, -0.178484181495847855851, 0, 0.178484181495847855851, 0.351231763453876315297,	\
		0.512690537086476967886, 0.657671159216690765850, 0.781514003896801406925, 0.880239153726985902123, 0.950675521768767761223,	\
		0.990575475314417335675 }), 
	({ 0.0241483028685479319601, 0.0554595293739872011294, 0.0850361483171791808835, 0.111883847193403971095, 0.135136368468525473286,	\
		0.154045761076810288081, 0.168004102156450044510, 0.176562705366992646325, 0.179446470356206525458, 0.176562705366992646325,	\
		0.168004102156450044510, 0.154045761076810288081, 0.135136368468525473286, 0.111883847193403971095, 0.0850361483171791808835,	\
		0.0554595293739872011294, 0.0241483028685479319601 })
);
__ML_CI_LIST_BUILD_ONE(
	18, 
	({ -0.991565168420930946730, -0.955823949571397755181, -0.892602466497555739206, -0.803704958972523115682, -0.691687043060353207875,	\
		-0.559770831073947534608, -0.411751161462842646036, -0.251886225691505509589, -0.0847750130417353012423, 0.0847750130417353012423,	\
		0.251886225691505509589, 0.411751161462842646036, 0.559770831073947534608, 0.691687043060353207875, 0.803704958972523115682,	\
		0.892602466497555739206, 0.955823949571397755181, 0.991565168420930946730 }), 
	({ 0.0216160135264833103133, 0.0497145488949697964533, 0.0764257302548890565291, 0.100942044106287165563, 0.122555206711478460185,	\
		0.140642914670650651205, 0.154684675126265244925, 0.164276483745832722986, 0.169142382963143591841, 0.169142382963143591841,	\
		0.164276483745832722986, 0.154684675126265244925, 0.140642914670650651205, 0.122555206711478460185, 0.100942044106287165563,	\
		0.0764257302548890565291, 0.0497145488949697964533, 0.0216160135264833103133 })
);
__ML_CI_LIST_BUILD_ONE(
	19, 
	({ -0.992406843843584403189, -0.960208152134830030853, -0.903155903614817901643, -0.822714656537142824979, -0.720966177335229378617,	\
		-0.600545304661681023470, -0.464570741375960945717, -0.316564099963629831990, -0.160358645640225375868, 0, 0.160358645640225375868,	\
		0.316564099963629831990, 0.464570741375960945717, 0.600545304661681023470, 0.720966177335229378617, 0.822714656537142824979,	\
		0.903155903614817901643, 0.960208152134830030853, 0.992406843843584403189 }), 
	({ 0.0194617882297264770363, 0.0448142267656996003328, 0.0690445427376412265807, 0.0914900216224499994645, 0.111566645547333994716,	\
		0.128753962539336227676, 0.142606702173606611776, 0.152766042065859666779, 0.158968843393954347650, 0.161054449848783695979,	\
		0.158968843393954347650, 0.152766042065859666779, 0.142606702173606611776, 0.128753962539336227676, 0.111566645547333994716,	\
		0.0914900216224499994645, 0.0690445427376412265807, 0.0448142267656996003328, 0.0194617882297264770363 })
);
__ML_CI_LIST_BUILD_ONE(
	20, 
	({ -0.993128599185094924786, -0.963971927277913791268, -0.912234428251325905868, -0.839116971822218823395, -0.746331906460150792614,	\
		-0.636053680726515025453, -0.510867001950827098004, -0.373706088715419560673, -0.227785851141645078080, -0.0765265211334973337546,	\
		0.0765265211334973337546, 0.227785851141645078080, 0.373706088715419560673, 0.510867001950827098004, 0.636053680726515025453,	\
		0.746331906460150792614, 0.839116971822218823395, 0.912234428251325905868, 0.963971927277913791268, 0.993128599185094924786 }), 
	({ 0.0176140071391521183119, 0.0406014298003869413310, 0.0626720483341090635695, 0.0832767415767047487248, 0.101930119817240435037,	\
		0.118194531961518417312, 0.131688638449176626898, 0.142096109318382051329, 0.149172986472603746788, 0.152753387130725850698,	\
		0.152753387130725850698, 0.149172986472603746788, 0.142096109318382051329, 0.131688638449176626898, 0.118194531961518417312,	\
		0.101930119817240435037, 0.0832767415767047487248, 0.0626720483341090635695, 0.0406014298003869413310, 0.0176140071391521183119 })
);

//Functions
double ML_FUNC_CC MathLib_CalculateIntegral(MathLib_CalculateIntegral_FunctionCallback pFunc, void *pParam, double fRangeBegin, double fRangeEnd, int n) {
	double fHalfOfRange, fHalfOfRangeBeginPlusEnd;
	const double *pfPoint, *pfWeight;
	double fResult;
	int nSign;

	if (pFunc == NULL)
		return MathLib_lfNaN;	//NaN

	switch (n) {
		__ML_CI_LIST_MAP(__ML_CI_LIST_BUILD_CASE);
	default:
		return MathLib_lfNaN;	//NaN
	}

	if (fRangeEnd < fRangeBegin) {
		double fTemp = fRangeBegin;
		fRangeBegin = fRangeEnd;
		fRangeEnd = fTemp;

		nSign = -1;
	}
	else {
		nSign = 1;
	}

	fHalfOfRange = (fRangeEnd - fRangeBegin) / 2;
	fHalfOfRangeBeginPlusEnd = (fRangeBegin + fRangeEnd) / 2;

	fResult = 0;

	for (int i = 0; i < n; i++) {
		fResult += pfWeight[i] * pFunc(fHalfOfRange * pfPoint[i] + fHalfOfRangeBeginPlusEnd, pParam);
	}

	fResult *= fHalfOfRange;

	return nSign * fResult;
}